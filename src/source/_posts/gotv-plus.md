---
title: GOTV+について
date: 2019-06-06 17:52:36
tags:
---

こんにちは！テクニカルエンジニアのFlowingです。
皆さんはメジャー大会のGOTVを見た事がありますか？
実は、メジャー大会のGOTVは通常のGOTVではなく、GOTV+(Official GOTV+)という特別なGOTVが使われています。
今回これを公開し、誰でも使えるようにしたバージョンを用意したので、簡単に説明して見ようと思います。

### 純正GOTVの説明
始めに、GOTVはゲームサーバー内の情報を、一定の遅延と共に観戦者に届けるシステムです。
これを利用することで、ゴースティングや外部からの干渉を防ぎ、プレイヤーに影響を与えず観戦を行うことが出来ます。
ただこのGOTVにはいくつか問題点があります。

1. サーバーが重くなる
一つ目の問題は、大人数の観戦者が繋ぐとサーバーが重くなることがある事です。
サーバーのスペックが良ければ抑制することは出来ますが、完全にラグを消すことは難しく、一定のパフォーマンスを失います。

2. 最大人数が64人
二つ目の問題は、最大人数が64人です。
コミュニティ大会規模であれば問題はありませんが、メジャー大会など数万人が観戦するレベルになるとこれはどう頑張っても収容しきれません。
これを解決する為に`tv_relay`というリレーコマンドがありますが、それを用いても最大人数は64-1人をネズミ算式にしか増やすことが出来ず、更にリレーサーバー自体も一つのサーバーなのでコストパフォーマンスが良くありません。

3. 回線がシビア
三つ目の問題は、同じく通常のゲームサーバーと同じくUDPプロトコルを使用している為パケットロスが発生しやすいです。
またVPNなどを利用しても、ヨーロッパ圏など遠隔地のパケットはどうしてもロスが発生してしまい、スムーズに観戦することが出来ません。(2014,2015年頃にメジャー大会を観戦した方ならわかるのではないでしょうか？)


これら三つの問題を解決するべく生み出されたのが、GOTV+です。

これは上記三つの問題を完璧に解決しているシステムです。

### GOTV+の説明
GOTV+は、HTTPの通信技術と、demのシステムをベースに開発されたAPIです。
通常のホームページをホストするようなソフトウェア(NodeJS,GoLANG)を使いホストする事が出来るので、多人数から同時に接続されても安定して処理が可能です。(問題1,2解決)
また、GOTV+はCDNというHTTP通信のキャッシュ技術を活用することで、世界中どのような場所に居ても安定した通信を行うことが出来ます(GoogleやTwitchがどこからアクセスしても高速で、同じコンテンツを保持しているのと同じような感じです)。
これにより、問題3も解決されています。

サーバーオーナーは試合用サーバーに設定コマンドを入力し、GOTV+のソフトウェアの立ち上げ・ポート開放を行うだけでGOTV+をホストすることが出来ます。
サーバーは設定されたコマンドを基に、GOTV+ソフトウェアにdemファイルの断片を3秒ごとに送り続けます。
GOTV+は、この断片をCSGOクライアントが取得出来るようにし、少しずつdemを繋げるようにして再生を行います。

#### GOTVのメリット
GOTV+がどのような物かわかったところで、どのような利点があるのか説明していきます。

1. 上記した問題1~3が全て解決される(全世界で超大人数が一つの試合を同時に観戦出来る)
2. demファイルの断片なので、demoで出来ることが全て出来る(早送り、一時停止、チートコマンド、HLAE/Reshadeの使用)
3. リプレイデータを保持する事で、オンライン上で再生出来るdemoとして機能させれる(demをダウンロードせずにリプレイを観戦出来る)

このようなメリットがあります。
1はコミュニティ大会では大事ではありませんが、2は大会演出の向上、3はユーザーに嬉しい機能ですね。

#### GOTVのデメリット
メリットを紹介した所で、デメリットも一緒に解説してみます。

1. 現在のコミュニティ規模で使う意味が薄い
現在のコミュニティではそもそもGOTV+を使うほど大きなイベントが無く、観戦もTwitchで行える為不要といえるかもしれません。

2. 観戦者の間で時間ズレがある
UDPではなくHTTP(TCP)を使用して通信している為、利用者同士で若干のズレが発生します。
Twitch.tvを同じタイミングで再生してもズレてしまうとの同じです。
その為、リアルタイムで話していたり、2画面並べて使うとズレが気になる場合があります。

3. CDNの設置が面倒
前述した通りCDNとうものを使えば全世界で低遅延の観戦を出来ますが、それには相応のコストがかかります。
ある程度の設定や技術が必要なので、「全世界で低遅延で観戦する」という利点を生かす場合それなりの手間がかかります。

以上がデメリットです。

### まとめ
いかがでしょうか？ GOTV+について簡単に纏めてみました。
GOTV+のソフトウェアを自作したい方は[Counter-Strike: Global Offensive Broadcast](https://developer.valvesoftware.com/wiki/Counter-Strike:_Global_Offensive_Broadcast)に簡単なAPIリファレンスを確認出来ます。
実際に動かしてみたい方は、[NodeJS版](https://github.com/theikkila/csgo-broadcast),[GO言語版](https://github.com/kunalpowar/csgo-broadcast),[TypeScript版](https://github.com/utage-tech/csgo-broadcast)がありますので試してみてはいかがでしょうか！
以上、[FlowingSPDG](https://twitter.com/FlowingSPDG)によるGOTV+の技術説明でした！

## WE WANT YOU!
UTAGE-Techではエンジニア・デザイナー・ライターを募集中です！
興味のある方は flowing[a]utage-csgo.com までメール下さいませ！